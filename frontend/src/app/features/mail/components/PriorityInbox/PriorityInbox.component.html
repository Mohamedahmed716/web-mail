<div class="inbox-container">
  
  <div class="inbox-list-section">
    <div class="toolbar">
      <div class="left-tools">
        <h2 class="page-title">Priority Inbox <span class="count-badge">{{ emails.length }}</span></h2>
      </div>
      <div class="right-tools">
        <button class="icon-btn"><i class="fa-solid fa-arrow-down-wide-short"></i></button>
        <button class="icon-btn"><i class="fa-solid fa-filter"></i></button>
        <button class="icon-btn" (click)="loadEmails()"><i class="fa-solid fa-rotate-right"></i></button>
      </div>
    </div>

    <div class="action-bar">
      <div class="checkbox-wrapper">
        <input 
          type="checkbox" 
          id="selectAll"
          (change)="toggleSelectAll($event)"
          [checked]="selectedEmailIds.length > 0 && selectedEmailIds.length === emails.length">
        <label for="selectAll">Select all</label>
      </div>
      
      <div class="actions">
        <button class="text-btn" [disabled]="selectedEmailIds.length === 0">Mark Read</button>
        
        <button class="text-btn" [disabled]="selectedEmailIds.length === 0">Move</button>
        
        <button 
          class="text-btn danger" 
          (click)="deleteSelected()"
          [disabled]="selectedEmailIds.length === 0">
          Delete ({{ selectedEmailIds.length }})
        </button>
      </div>
    </div>

    @if (isLoading) {
      <div class="loading-state">
        Loading priority emails...
      </div>
    } 
    @else if (errorMessage) {
      <div class="error-state">
        {{ errorMessage }}
      </div>
    } 
    @else {
      <div class="email-list">
      
      @for (email of emails; track email) {
        
        <div 
          class="email-item"
          (click)="selectEmail(email)" 
          [class.active]="selectedEmail===email">

          
          <div class="email-select" (click)="$event.stopPropagation()">
            <input 
              type="checkbox"
              [checked]="selectedEmailIds.includes(email.id)"
              (change)="toggleSelectEmail(email.id, $event)">
          </div>

          <div class="email-content">
            
            <div class="email-top-row">
              <span class="sender-name">{{ email.sender }}</span>
              
             <span class="email-priority">
                @switch (email.priority) {
                  @case (4) {
                    <i class="fa-solid fa-exclamation-circle urgent-priority" title="Critical Priority"></i>
                  }
                  @case (3) {
                    <i class="fa-solid fa-exclamation-triangle high-priority" title="High Priority"></i>
                  }
                  @case (2) {
                    <i class="fa-solid fa-info-circle medium-priority" title="Medium Priority"></i>
                  }
                  @case (1) {
                    <i class="fa-solid fa-circle-dot low-priority" title="Low Priority"></i>
                  }
                  @default {
                    <i class="fa-solid fa-check-circle no-priority" title="No Priority"></i>
                  }
                }
                
             </span>
              <span class="email-time">{{ email.timestamp | date:'shortTime' }}</span>
            </div>

            <div class="email-subject">
              {{ email.subject }}
            </div>

            <div class="email-snippet">
              {{ email.body }}
            </div>

          </div>
        </div>

      } @empty {
        <div class="empty-state">
          No important emails found.
        </div>
      }

      </div>
    }

    <div class="pagination">
      <button (click)="changePage(-1)" [disabled]="currentPage === 1">
        <i class="fa-solid fa-chevron-left"></i> Prev
      </button>
      <span>{{ currentPage }} of Â {{totalPages}}</span>
      <button (click)="changePage(1)">
        Next <i class="fa-solid fa-chevron-right"></i>
      </button>
    </div>
  </div>

  @if (selectedEmail) {
    <div class="email-display-pane">
      <app-EmailDisplay [mail]="selectedEmail" [type]="'inbox'"></app-EmailDisplay>
    </div>
  }

</div>