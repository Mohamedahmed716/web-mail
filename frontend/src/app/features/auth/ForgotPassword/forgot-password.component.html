<div class="auth-wrapper">
    <div class="auth-card">
        <div class="card-header">
            <div class="icon-wrapper">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>
            <h2>Reset Password</h2>
            <p>{{ currentStep === 'email' ? 'Enter your email to get started' :
                currentStep === 'security' ? 'Answer your security question' :
                currentStep === 'password' ? 'Create a new password' :
                'Password reset successful!' }}</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-steps" *ngIf="currentStep !== 'success'">
            <div class="step" [class.active]="currentStep === 'email'" [class.completed]="currentStep !== 'email'">
                <div class="step-circle">1</div>
                <span>Email</span>
            </div>
            <div class="step-line" [class.completed]="currentStep === 'security' || currentStep === 'password'"></div>
            <div class="step" [class.active]="currentStep === 'security'"
                [class.completed]="currentStep === 'password'">
                <div class="step-circle">2</div>
                <span>Verify</span>
            </div>
            <div class="step-line" [class.completed]="currentStep === 'password'"></div>
            <div class="step" [class.active]="currentStep === 'password'">
                <div class="step-circle">3</div>
                <span>Reset</span>
            </div>
        </div>

        <div class="card-body">
            <!-- Step 1: Email Verification -->
            <form *ngIf="currentStep === 'email'" [formGroup]="emailForm" (ngSubmit)="onEmailSubmit()">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <div class="rounded-input email-field-wrapper">
                        <input type="text" id="email" formControlName="email" placeholder="your.name"
                            class="username-input-part" />
                        <span class="domain-suffix">@wegmail.com</span>
                    </div>
                    <small class="helper-text">Enter your registered email address</small>
                </div>

                <button type="submit" class="submit-btn" [disabled]="isLoading || emailForm.invalid">
                    <span *ngIf="!isLoading">Continue</span>
                    <span *ngIf="isLoading">Verifying...</span>
                    <svg *ngIf="!isLoading" class="btn-arrow" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
            </form>

            <!-- Step 2: Security Question -->
            <form *ngIf="currentStep === 'security'" [formGroup]="securityForm" (ngSubmit)="onSecuritySubmit()">
                <div class="security-info">
                    <div class="info-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4"></path>
                            <path d="M12 8h.01"></path>
                        </svg>
                    </div>
                    <p>To verify your identity, what is the name of the <strong>favorite movie</strong> you entered
                        during sign-up?</p>
                </div>

                <div class="form-group">
                    <label for="favoriteMovie">Your Answer</label>
                    <input type="text" id="favoriteMovie" formControlName="favoriteMovie" class="rounded-input"
                        placeholder="Enter your favorite movie" />
                </div>

                <div class="button-group">
                    <button type="button" class="back-btn" (click)="goBack()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Back
                    </button>
                    <button type="submit" class="submit-btn" [disabled]="isLoading || securityForm.invalid">
                        <span *ngIf="!isLoading">Verify</span>
                        <span *ngIf="isLoading">Verifying...</span>
                    </button>
                </div>
            </form>

            <!-- Step 3: New Password -->
            <form *ngIf="currentStep === 'password'" [formGroup]="passwordForm" (ngSubmit)="onPasswordSubmit()">
                <div class="success-info" *ngIf="successMessage">
                    <div class="info-icon success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <p>{{ successMessage }}</p>
                </div>

                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="input-container">
                        <input [type]="showPassword ? 'text' : 'password'" id="newPassword"
                            formControlName="newPassword" class="rounded-input"
                            placeholder="Enter new password (min 6 characters)" />
                        <button type="button" class="eye-btn" (click)="togglePassword()">
                            <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" />
                                <path
                                    d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" />
                                <path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" />
                                <line x1="2" x2="22" y1="2" y2="22" />
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input [type]="showPassword ? 'text' : 'password'" id="confirmPassword"
                        formControlName="confirmPassword" class="rounded-input"
                        [class.error-border]="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmPassword')?.touched"
                        placeholder="Re-enter your new password" />
                    <div *ngIf="passwordForm.errors?.['mismatch'] && passwordForm.get('confirmPassword')?.touched"
                        class="field-error-text">
                        Passwords do not match
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="back-btn" (click)="goBack()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        Back
                    </button>
                    <button type="submit" class="submit-btn" [disabled]="isLoading || passwordForm.invalid">
                        <span *ngIf="!isLoading">Reset Password</span>
                        <span *ngIf="isLoading">Resetting...</span>
                    </button>
                </div>
            </form>

            <!-- Success State -->
            <div *ngIf="currentStep === 'success'" class="success-state">
                <div class="success-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
                <h3>Password Reset Successful!</h3>
                <p>Your password has been successfully reset. You can now log in with your new password.</p>
                <button type="button" class="submit-btn" (click)="goToLogin()">
                    Go to Sign In
                    <svg class="btn-arrow" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </button>
            </div>

            <!-- Error Message -->
            <div *ngIf="errorMessage" class="error-banner">
                {{ errorMessage }}
            </div>
        </div>

        <div class="footer-link" *ngIf="currentStep !== 'success'">
            Remember your password? <a routerLink="/signin">Sign in</a>
        </div>
    </div>
</div>