<div class="overlay" *ngIf="isVisible" (click)="close()">
  <div class="modal-container" (click)="stopProp($event)">

    <div class="modal-content-wrapper" *ngIf="email">

      <div class="modal-header">
        <h3>{{ email.subject || 'New Message' }}</h3>
        <button class="close-btn" (click)="close()">×</button>
      </div>

      <div class="modal-body">

        <div class="form-group">
          <label>To</label>
          <input type="text" [(ngModel)]="receiverEmails" placeholder="recipient@example.com, another@example.com">
        </div>

        <div class="form-row">
          <div class="form-group grow">
            <label>Subject</label>
            <input type="text" [(ngModel)]="email.subject" placeholder="What is this regarding?">
          </div>
          <div class="form-group">
            <label>Priority</label>
            <select [(ngModel)]="email.priority">
              <option [ngValue]="1">Low</option>
              <option [ngValue]="2">Medium</option>
              <option [ngValue]="3">High</option>
              <option [ngValue]="4">Critical</option>
            </select>
          </div>
        </div>

        <div class="attachment-section">
          <div class="attachment-actions">
            <input type="file" id="fileUpload" multiple (change)="onFileSelected($event)" style="display: none;">
            <label for="fileUpload" class="attach-btn">
              <i class="fa-solid fa-paperclip"></i> Attach Files
            </label>
          </div>

          <div class="file-list" *ngIf="email?.attachments && email.attachments.length > 0">
            <div class="file-chip" *ngFor="let file of email.attachments; let i = index">
              <span class="file-name clickable" [title]="file.name" (click)="openFile(file, $event)">
                {{ file.name }}
              </span>
              <span class="file-size" style="font-size: 0.7em; opacity: 0.7; margin-left: 5px;">
                ({{ (file.size / 1024) | number:'1.0-1' }} KB)
              </span>
              <span class="remove-file" (click)="removeAttachment(i)">×</span>
            </div>
          </div>
        </div>

        <div class="form-group flex-grow">
          <textarea [(ngModel)]="email.body" placeholder="Write your message here..."></textarea>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="saveDraft()">Save Draft</button>
        <div class="right-actions">
          <button class="btn-cancel" (click)="close()">Discard</button>
          <button class="btn-primary" (click)="sendEmail()">Send</button>
        </div>
      </div>

    </div>
  </div>
</div>
